<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Recipients - Employee Tracker</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">Employee Tracker</div>
    <div class="nav-links">
      <a href="/dashboard">Dashboard</a>
      <a href="/employees">Employees</a>
      <a href="/records">Records</a>
      <a href="/recipients" class="active">Email Recipients</a>
      <a href="/logout" class="logout-link">Logout</a>
    </div>
  </nav>

  <main class="container">
    <div class="page-header">
      <h1>Email Recipients</h1>
    </div>

    <div class="card form-card">
      <h3>Add Email Recipient</h3>
      <p>These email addresses will receive the daily attendance email.</p>

      <% if (error) { %>
        <div class="alert alert-error"><%= error %></div>
      <% } %>

      <% if (success) { %>
        <div class="alert alert-success"><%= success %></div>
      <% } %>

      <form method="POST" action="/recipients" class="inline-form" id="addRecipientForm">
        <div class="form-group">
          <input type="email" name="email" id="emailInput" placeholder="email@example.com" required
                 maxlength="254" pattern="[^\s@]+@[^\s@]+\.[^\s@]+">
        </div>
        <button type="submit" class="btn btn-primary" id="addRecipientBtn">Add Recipient</button>
      </form>

      <script>
        const form = document.getElementById('addRecipientForm');
        const submitBtn = document.getElementById('addRecipientBtn');
        const emailInput = document.getElementById('emailInput');

        form.addEventListener('submit', function(e) {
          const email = emailInput.value.trim();

          // Basic email validation
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!email || !emailRegex.test(email)) {
            e.preventDefault();
            emailInput.focus();
            return;
          }

          if (submitBtn.disabled) {
            e.preventDefault();
            return;
          }

          submitBtn.disabled = true;
          submitBtn.textContent = 'Adding...';
          submitBtn.style.opacity = '0.7';
        });
      </script>
    </div>

    <% if (recipients.length > 0) { %>
      <table>
        <thead>
          <tr>
            <th>Email</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% recipients.forEach(recipient => { %>
            <tr class="<%= !recipient.active ? 'inactive-row' : '' %>">
              <td><%= recipient.email %></td>
              <td>
                <span class="badge <%= recipient.active ? 'badge-active' : 'badge-inactive' %>">
                  <%= recipient.active ? 'Active' : 'Inactive' %>
                </span>
              </td>
              <td>
                <form method="POST" action="/recipients/<%= recipient.id %>/toggle" style="display: inline;">
                  <button type="submit" class="btn btn-small btn-secondary">
                    <%= recipient.active ? 'Deactivate' : 'Activate' %>
                  </button>
                </form>
                <form method="POST" action="/recipients/<%= recipient.id %>/delete" style="display: inline;">
                  <button type="submit" class="btn btn-small btn-danger" onclick="return confirm('Delete this recipient?')">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <div class="empty-state">
        <p>No email recipients configured.</p>
        <p>Add an email address above to start receiving daily attendance emails.</p>
      </div>
    <% } %>
  </main>
</body>
</html>
